dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-1.txt")
normalize_table <- function(x) {
x / sum(x)
}
ramp_12_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_12_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_12_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
corn_otu <- read_tsv("corn_lefse.txt", skip = 1)
names(corn_otu)[1] <- "OTUID"
corn_fams <- corn_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
corn_lefse <- read_tsv("corn_lefse_result.txt", col_names = F)
corn_lefse <- corn_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(corn_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-1.txt")
normalize_table <- function(x) {
x / sum(x)
}
ramp_12_table <- read_tsv("split_total/otu_table_tax_final__Diet_Corn__filter.txt", skip = 1)
names(ramp_12_table)[1] <- "OTUID"
ramp_12_table
stop()
corn_otu <- read_tsv("corn_lefse.txt", skip = 1)
names(corn_otu)[1] <- "OTUID"
corn_fams <- corn_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
corn_lefse <- read_tsv("corn_lefse_result.txt", col_names = F)
corn_lefse <- corn_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(corn_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-1.txt")
normalize_table <- function(x) {
x / sum(x)
}
corn_table <- read_tsv("split_total/otu_table_tax_final__Diet_Corn__filter.txt", skip = 1)
names(corn_table)[1] <- "OTUID"
corn_table
stop()
corn_otu <- read_tsv("corn_lefse.txt", skip = 1)
names(corn_otu)[1] <- "OTUID"
corn_fams <- corn_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
corn_lefse <- read_tsv("corn_lefse_result.txt", col_names = F)
corn_lefse <- corn_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(corn_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-1.txt")
normalize_table <- function(x) {
x / sum(x)
}
corn_table <- read_tsv("split_total/otu_table_tax_final__Diet_Corn__filter.txt", skip = 1)
names(corn_table)[1] <- "OTUID"
corn_otu_lefse <- corn_table %>%
rename(CF_332 = R10, C3_346 = R15, C4_332 = R16, CF_346 = R2, C3_332 = R22, C1_346 = R36, C2_332 = R37, C1_332 = R40, C2_346 = R41, C4_346 = R9) %>%
select(OTUID, C1_346, C1_332, C2_346, C2_332, C3_346, C3_332, C4_346, C4_332, CF_346, CF_332)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(C1_346:CF_332, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(corn_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelA.pdf", width = 12, height = 9)
corn_otu_lefse %>%
select(starts_with("C", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = corn_otu_lefse$family)
dev.off()
# packrat::clean()
# packrat::bundle()
# packrat::unbundle()
# sessionInfo()
library(Biostrings)
library(stringr)
library(tidyverse)
library(XML)
library(forcats)
library(rmarkdown)
library(knitr)
library(grid)
library(vegan)
library(magrittr)
library(biom)
library(gplots)
library(Heatplus)
library(RColorBrewer)
source("functions.R")
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# first microbial shift between steps 1 and 2
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# second microbial shift between steps 2 and 3
ramp_23_otu <- read_tsv("ramp_23_lefse.txt", skip = 1)
names(ramp_23_otu)[1] <- "OTUID"
ramp_23_fams <- ramp_23_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_23_fams
# first microbial shift between steps 1 and 2
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# second microbial shift between steps 2 and 3/4/F
ramp_23_otu <- read_tsv("ramp_23_lefse.txt", skip = 1)
names(ramp_23_otu)[1] <- "OTUID"
ramp_23_fams <- ramp_23_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_23_lefse <- read_tsv("ramp_23_lefse_result.txt", col_names = F)
ramp_23_lefse <- ramp_23_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_23_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-3.txt")
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R2_222, R2_259, R2_343, R3_222, R3_259, R3_343, R4_222, R4_259, R4_343, RF_222, RF_259, RF_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_23_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
# first microbial shift between steps 1 and 2
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# second microbial shift between steps 2 and 3/4/F
ramp_23_otu <- read_tsv("ramp_23_lefse.txt", skip = 1)
names(ramp_23_otu)[1] <- "OTUID"
ramp_23_fams <- ramp_23_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_23_lefse <- read_tsv("ramp_23_lefse_result.txt", col_names = F)
ramp_23_lefse <- ramp_23_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_23_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-3.txt")
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R2_222, R2_259, R2_343, R3_222, R3_259, R3_343, R4_222, R4_259, R4_343, RF_222, RF_259, RF_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R2_222:RF_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_23_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelC.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_23_otu_lefse$family)
# first microbial shift between steps 1 and 2
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# second microbial shift between steps 2 and 3/4/F
ramp_23_otu <- read_tsv("ramp_23_lefse.txt", skip = 1)
names(ramp_23_otu)[1] <- "OTUID"
ramp_23_fams <- ramp_23_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_23_lefse <- read_tsv("ramp_23_lefse_result.txt", col_names = F)
ramp_23_lefse <- ramp_23_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_23_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-3.txt")
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R2_222, R2_259, R2_343, R3_222, R3_259, R3_343, R4_222, R4_259, R4_343, RF_222, RF_259, RF_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R2_222:RF_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_23_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelC.pdf", width = 12, height = 9)
ramp_23_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_23_otu_lefse$family)
# first microbial shift between steps 1 and 2
ramp_12_otu <- read_tsv("ramp_12_lefse.txt", skip = 1)
names(ramp_12_otu)[1] <- "OTUID"
ramp_12_fams <- ramp_12_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_12_lefse <- read_tsv("ramp_12_lefse_result.txt", col_names = F)
ramp_12_lefse <- ramp_12_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_12_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-2.txt")
ramp_table <- read_tsv("split_total/otu_table_tax_final__Diet_RAMP__filter.txt", skip = 1)
names(ramp_table)[1] <- "OTUID"
ramp_12_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R1_222, R1_259, R1_343, R2_222, R2_259, R2_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R1_222:R2_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_12_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelB.pdf", width = 12, height = 9)
ramp_12_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_12_otu_lefse$family)
dev.off()
# second microbial shift between steps 2 and 3/4/F
ramp_23_otu <- read_tsv("ramp_23_lefse.txt", skip = 1)
names(ramp_23_otu)[1] <- "OTUID"
ramp_23_fams <- ramp_23_otu %>%
mutate(family = str_extract(taxonomy, "(?<=f__)[\\[\\]\\w\\d]+")) %>%
mutate(family = str_replace_all(family, "[\\[\\]]", "")) %>%
mutate(family = str_replace_na(family, replacement = "No Assigned Family")) %>%
select(OTUID, family)
ramp_23_lefse <- read_tsv("ramp_23_lefse_result.txt", col_names = F)
ramp_23_lefse <- ramp_23_lefse %>%
dplyr::rename(OTUID = X1, raw = X2, breaks = X3, LDA = X4, pval = X5) %>%
mutate(OTUID = as.integer(str_replace(OTUID, "OTU", ""))) %>%
left_join(ramp_23_fams, ., by = "OTUID") %>%
arrange(breaks, desc(LDA)) %>%
write_tsv("Table_S2-3.txt")
ramp_23_otu_lefse <- ramp_table %>%
rename(R3_259 = R11, R2_343 = R12, R4_343 = R13, R4_259 = R14, R1_222 = R18, RF_343 = R20, RF_222 = R21, R2_222 = R23, R1_343 = R24, R3_343 = R3, R2_259 = R38, R3_222 = R4, R4_222 = R5, RF_259 = R7, R1_259 = R8) %>%
select(OTUID, R2_222, R2_259, R2_343, R3_222, R3_259, R3_343, R4_222, R4_259, R4_343, RF_222, RF_259, RF_343)  %>%
mutate_each(funs(normalize_table), -OTUID) %>%
gather(R2_222:RF_343, key = sample, value = abundance) %>%
group_by(OTUID) %>%
filter(any(abundance > 0.01)) %>%
ungroup() %>%
spread(key = sample, value = abundance) %>%
mutate(OTUID = as.integer(OTUID)) %>%
inner_join(ramp_23_lefse, by = "OTUID") %>%
arrange(breaks, desc(LDA))
scalewhiteblack <- colorRampPalette(c("white", "black"), space = "rgb")(100)
lmat = rbind(c(4,0,0),c(2,1,3))
lwid = c(0.60,1.9,0.3)
lhei = c(0.3,1.5)
pdf("Figure3_panelC.pdf", width = 12, height = 9)
ramp_23_otu_lefse %>%
select(starts_with("R", ignore.case = F)) %>%
t() %>%
heatmap.2(Rowv = F, Colv = F, col = scalewhiteblack, margins = c(13, 9.5), trace = "none", density.info = "none", xlab = "", ylab = "", main = "", srtCol = 67.5, cexCol = 1.3, cexRow = 2.0, lmat = lmat, lwid = lwid, lhei = lhei, labCol = ramp_23_otu_lefse$family)
dev.off()
